---
description: 从交互式或提供的原则输入创建或更新项目章程，确保所有依赖模板保持同步。
handoffs: 
  - label: 构建规范
    agent: speckit.specify
    prompt: 根据更新后的章程实现功能规范。我想构建...
---

## 用户输入```text
$ARGUMENTS
```在继续之前，你**必须**考虑用户输入（如果不为空）。

## 概述

你正在更新位于 `.specify/memory/constitution.md` 的项目宪法。该文件是一个**模板**，包含方括号内的占位符标记（例如 `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）。你的任务是 获取/推导 具体数值， 准确填充模板，以及 跨相关制品传播所有修订内容。

**注意**：如果 `.specify/memory/constitution.md` 尚不存在，它本应在项目设置期间从 `.specify/templates/constitution-template.md` 初始化。如果缺失，请先复制模板。

请遵循以下执行流程：

1. 加载位于 `.specify/memory/constitution.md` 的现有宪法。
   - 识别每一个 `[ALL_CAPS_IDENTIFIER]` 形式的占位符标记。
   **重要**：用户要求的原则数量可能少于或多于模板中使用的数量。如果指定了数量，请予以尊重——遵循通用模板。你将相应地更新文档。

2. 收集/推导占位符的值：
   - 如果用户输入（对话）提供了值，请使用它。
   - 否则从现有的仓库上下文（README、文档、嵌入的先前宪法版本）推断。
   - 对于治理日期：`RATIFICATION_DATE` 是原始通过日期（如果未知请询问或标记 TODO），`LAST_AMENDED_DATE` 如果进行了更改则为今天，否则保留之前的日期。
   - `CONSTITUTION_VERSION` 必须根据语义化版本控制规则递增：
     - 主版本号（MAJOR）：不向后兼容的治理/原则删除或重新定义。
     - 次版本号（MINOR）：新增原则/章节或实质性扩展的指导。
     - 修订号（PATCH）：澄清、措辞、错别字修复、非语义性的改进。
   - 如果版本升级类型不明确，请在最终确定前提出理由。

3. 起草更新后的宪法内容：
   - 用具体文本替换每个占位符（除非项目选择尚未定义的特意保留的模板槽位——明确证明任何保留项的合理性——否则不得留下括号标记）。
   - 保留标题层级，注释一旦替换即可删除，除非它们仍提供澄清性指导。
   - 确保每个原则部分包含：简洁的名称行，捕捉不可协商规则的段落（或项目符号列表），以及（如果不明显）明确的理由。
   - 确保治理部分列出修正程序、版本控制策略和合规审查期望。

4. 一致性传播检查清单（将先前的检查清单转换为主动验证）：
   - 读取 `.specify/templates/plan-template.md` 并确保所有“宪法检查”或规则与更新后的原则一致。
   - 读取 `.specify/templates/spec-template.md` 以对齐范围/需求——如果宪法添加/删除了强制部分或约束，请更新。
   - 读取 `.specify/templates/tasks-template.md` 并确保任务分类反映了新增或删除的原则驱动任务类型（例如，可观测性、版本控制、测试规范）。
   - 读取 `.specify/templates/commands/*.md` 中的每个命令文件（包括本文件），以验证当需要通用指导时，不存在过时的引用（例如仅针对 CLAUDE 的特定名称）。
   - 读取任何运行时指导文档（例如 `README.md`、`docs/quickstart.md` 或存在的特定于代理的指导文件）。更新对已更改原则的引用。

5. 生成同步影响报告（在更新后作为 HTML 注释前置在宪法文件顶部）：
   - 版本变更：旧 → 新
   - 修改的原则列表（如果重命名，则为旧标题 → 新标题）
   - 新增部分
   - 删除部分
   - 需要更新的模板（✅ 已更新 / ⚠ 待处理）及文件路径
   - 后续待办事项（如有故意推迟的占位符）。

6. 最终输出前的验证：
   - 没有遗留未解释的括号标记。
   - 版本行与报告匹配。
   - 日期格式为 ISO YYYY-MM-DD。
   - 原则应是声明性的、可测试的，且无模糊语言（“should” → 在适当情况下替换为 MUST/SHOULD 并说明理由）。

7. 将完成的宪法写回 `.specify/memory/constitution.md`（覆盖）。

8. 向用户输出最终摘要，包括：
   - 新版本及升级理由。
   - 任何标记为需手动跟进的文件。
   - 建议的提交信息（例如，`docs: amend constitution to vX.Y.Z (principle additions + governance update)`）。

格式与样式要求：

- 使用与模板中完全一致的 Markdown 标题（不要降级/升级层级）。
- 换行长理由行以保持可读性（理想情况下 <100 字符），但不要强制进行别扭的换行。
- 各部分之间保留一个空行。
- 避免尾随空格。

如果用户提供部分更新（例如，仅修订一个原则），仍需执行验证和版本决策步骤。

如果缺少关键信息（例如，批准日期确实未知），请插入 `TODO(<FIELD_NAME>): explanation` 并将其包含在同步影响报告的推迟项目中。

不要创建新模板；始终在现有的 `.specify/memory/constitution.md` 文件上操作。