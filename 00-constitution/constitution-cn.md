---
description: 通过交互式或提供的原则输入创建或更新项目章程，确保所有依赖模板保持同步。
handoffs:
  - label: 构建规格说明
    agent: speckit.specify
    prompt: 根据更新的章程实施功能规范。我想要构建...
---

## 用户输入```text
$ARGUMENTS
```在继续之前，你**必须**考虑用户输入（若非空）。

## 概述

你正在更新 `.specify/memory/constitution.md` 处的项目章程。该文件是一个模板，包含方括号内的占位符（例如 `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）。你的工作是： 收集/推导具体数值， 精确填充模板，以及 将所有修订传播至依赖工件。

**注意**：若 `.specify/memory/constitution.md` 尚不存在，它本应在项目设置期间从 `.specify/templates/constitution-template.md` 初始化。如果缺失，请先复制模板。

请遵循以下执行流程：

1. 加载 `.specify/memory/constitution.md` 处的现有章程。
   - 识别所有形式为 `[ALL_CAPS_IDENTIFIER]` 的占位符标记。
   **重要**：用户要求的原则数量可能少于或多于模板中使用的原则。若指定了数量，请予以尊重——遵循通用模板。你将据此更新文档。

2. 收集/推导占位符的值：
   - 若用户输入（对话）提供了值，请使用该值。
   - 否则从现有仓库上下文（README、文档、先前嵌入的章程版本）推断。
   - 关于治理日期：`RATIFICATION_DATE` 为原始采纳日期（若未知则询问或标记 TODO）；若进行了更改，`LAST_AMENDED_DATE` 设为今日，否则保留先前日期。
   - `CONSTITUTION_VERSION` 必须根据语义化版本控制规则递增：
     - MAJOR（主版本号）：不向后兼容的治理/原则删除或重定义。
     - MINOR（次版本号）：新增原则/章节或实质性扩展的指导。
     - PATCH（修订号）：澄清、措辞调整、错别字修复、非语义性的改进。
   - 若版本升级类型不明确，请在最终确定前提出理由。

3. 拟定更新后的章程内容：
   - 将每个占位符替换为具体文本（除项目选择暂不定义而有意保留的模板槽位外，不得遗留括号标记——如有保留需明确说明理由）。
   - 保留标题层级；注释一经替换即可移除，除非它们仍具澄清指导作用。
   - 确保每个原则章节包含：简练的名称行、阐述不可协商规则的段落（或无序列表），以及非显而易见情况下的明确理由。
   - 确保治理章节列出修订程序、版本控制策略及合规审查期望。

4. 一致性传播检查清单（将先前的检查清单转化为主动验证）：
   - 读取 `.specify/templates/plan-template.md` 并确保任何“章程检查”或规则与更新后的原则保持一致。
   - 读取 `.specify/templates/spec-template.md` 以检查范围/需求的一致性——若章程增删了强制性章节或约束，请进行更新。
   - 读取 `.specify/templates/tasks-template.md` 并确保任务分类反映了新增或移除的原则驱动型任务类型（例如：可观测性、版本控制、测试规范）。
   - 读取 `.specify/templates/commands/*.md` 中的每个命令文件（包括本文件），以验证在需要通用指导时，不存在过时的引用（如仅针对特定代理的名称，例如 CLAUDE）。
   - 读取任何运行时指导文档（例如 `README.md`、`docs/quickstart.md` 或特定代理的指导文件（若存在））。更新对已变更原则的引用。

5. 生成同步影响报告（更新后作为 HTML 注释置于章程文件顶部）：
   - 版本变更：旧 → 新
   - 修改的原则列表（若重命名，注明 旧标题 → 新标题）
   - 新增章节
   - 移除章节
   - 需要更新的模板（✅ 已更新 / ⚠ 待定）及其文件路径
   - 后续待办事项，若有占位符被有意推迟处理。

6. 最终输出前的验证：
   - 无遗留未说明的括号标记。
   - 版本行与报告一致。
   - 日期采用 ISO 格式 YYYY-MM-DD。
   - 原则须具声明性、可测试性，且无模糊语言（将 "should" 替换为 MUST/SHOULD 并在适当处说明理由）。

7. 将完成的章程写回 `.specify/memory/constitution.md`（覆盖写入）。

8. 向用户输出最终摘要，包含：
   - 新版本号及升级理由。
   - 任何标记需人工跟进的文件。
   - 建议的提交信息（例如：`docs: amend constitution to vX.Y.Z (principle additions + governance update)`）。

格式与风格要求：

- 严格按模板使用 Markdown 标题（勿降级或升级层级）。
- 对较长的理由行进行换行以保持可读性（理想宽度 <100 字符），但切勿强行断句导致阅读困难。
- 章节间保留单个空行。
- 避免行尾空格。

若用户提供部分更新（例如仅修订一条原则），仍须执行验证和版本决策步骤。

若关键信息缺失（例如批准日期确实未知），请插入 `TODO(<FIELD_NAME>): explanation` 并在同步影响报告的延期事项中列出。

切勿创建新模板；始终基于现有的 `.specify/memory/constitution.md` 文件进行操作。